enum UserRole {
    Student
    Tutor
    Admin
}

enum BookingStatus {
    CONFIRMED
    COMPLETED
    CANCELLED
}

model User {
    id            String   @id
    name          String
    email         String
    emailVerified Boolean  @default(false)
    image         String?
    createdAt     DateTime @default(now())
    updatedAt     DateTime @updatedAt

    // Better Auth relations
    sessions Session[]
    accounts Account[]

    role   String? @default("USER")
    phone  String?
    status String? @default("ACTIVE")

    // Application relations (NEW)
    tutorProfile      TutorProfile?
    bookingsAsStudent Booking[]     @relation("StudentBookings")
    bookingsAsTutor   Booking[]     @relation("TutorBookings")
    reviews           Review[]

    @@unique([email])
    @@map("user")
}

model Session {
    id        String   @id
    expiresAt DateTime
    token     String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    ipAddress String?
    userAgent String?
    userId    String
    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([token])
    @@index([userId])
    @@map("session")
}

model Account {
    id                    String    @id
    accountId             String
    providerId            String
    userId                String
    user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
    accessToken           String?
    refreshToken          String?
    idToken               String?
    accessTokenExpiresAt  DateTime?
    refreshTokenExpiresAt DateTime?
    scope                 String?
    password              String?
    createdAt             DateTime  @default(now())
    updatedAt             DateTime  @updatedAt

    @@index([userId])
    @@map("account")
}

model TutorProfile {
    id            String   @id @default(cuid())
    userId        String   @unique
    bio           String   @db.Text
    expertise     String[]
    hourlyRate    Float
    experience    String?
    education     String?
    rating        Float    @default(0)
    totalReviews  Int      @default(0)
    totalSessions Int      @default(0)
    availability  Json? // Store as JSON: [{ day: "Monday", slots: ["09:00-10:00", "10:00-11:00"] }]
    isApproved    Boolean  @default(false)
    createdAt     DateTime @default(now())
    updatedAt     DateTime @updatedAt

    // Relations
    user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
    categories Category[]

    @@map("tutor_profile")
}

model Category {
    id          String   @id @default(cuid())
    name        String   @unique
    description String?  @db.Text
    icon        String?
    isActive    Boolean  @default(true)
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    // Relations
    tutors TutorProfile[]

    @@map("category")
}

model Booking {
    id                 String        @id @default(cuid())
    studentId          String
    tutorId            String
    sessionDate        DateTime
    sessionTime        String
    duration           Int           @default(60) // minutes
    subject            String
    price              Float
    status             BookingStatus @default(CONFIRMED)
    notes              String?       @db.Text
    meetingLink        String?
    cancelledBy        String?
    cancellationReason String?       @db.Text
    createdAt          DateTime      @default(now())
    updatedAt          DateTime      @updatedAt

    // Relations
    student User    @relation("StudentBookings", fields: [studentId], references: [id])
    tutor   User    @relation("TutorBookings", fields: [tutorId], references: [id])
    review  Review?

    @@index([studentId])
    @@index([tutorId])
    @@index([sessionDate])
    @@map("booking")
}

model Review {
    id        String   @id @default(cuid())
    bookingId String   @unique
    studentId String
    tutorId   String
    rating    Int // 1-5
    comment   String   @db.Text
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    // Relations
    booking Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)
    student User    @relation(fields: [studentId], references: [id])

    @@index([tutorId])
    @@index([studentId])
    @@map("review")
}
